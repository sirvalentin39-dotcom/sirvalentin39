<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ .mcaddon</title>
    
    <!-- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ JSZip -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <style>
        /* --- CSS –°–¢–ò–õ–Ü --- */
        
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f2f5;
        }

        .container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            padding: 20px;
            box-sizing: border-box;
        }

        .card {
            background-color: white;
            padding: 30px 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            text-align: center;
            max-width: 400px;
            width: 100%;
        }

        h1 {
            color: #1c1e21;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 24px;
        }

        p.info {
            color: #606770;
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 20px;
        }

        .btn {
            color: white;
            border: none;
            padding: 15px 25px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease;
            width: 100%;
            text-decoration: none;
            display: inline-block;
            box-sizing: border-box;
            margin-top: 10px;
        }

        .btn:active {
            transform: scale(0.98);
        }

        #prepareBtn {
            background-color: #007bff;
        }

        #prepareBtn:hover {
            background-color: #0056b3;
        }
        
        #prepareBtn:disabled {
            background-color: #a0a0a0;
            cursor: not-allowed;
        }
        
        #downloadLinkBtn {
            background-color: #28a745; /* –ó–µ–ª–µ–Ω–∏–π */
        }

        #downloadLinkBtn:hover {
            background-color: #218838;
        }

        #returnBtn {
            background-color: #17a2b8; /* –ë—ñ—Ä—é–∑–æ–≤–∏–π */
        }
        #returnBtn:hover {
            background-color: #138496;
        }
        
        /* –°–µ–∫—Ü—ñ—ó, —è–∫—ñ –º–∏ –±—É–¥–µ–º–æ –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏/—Ö–æ–≤–∞—Ç–∏ */
        #linkReadySection, #postDownloadSection {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h1>–ó–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—á MCAddon</h1>

            <!-- –°–µ–∫—Ü—ñ—è 1: –ü–æ—á–∞—Ç–∫–æ–≤–∏–π –µ–∫—Ä–∞–Ω (–≤–∏–¥–∏–º–∏–π –≤ Telegram) -->
            <div id="initialSection">
                <p class="info">–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å, —â–æ–± –ø—ñ–¥–≥–æ—Ç—É–≤–∞—Ç–∏ —Ñ–∞–π–ª –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —É –≤–∞—à–æ–º—É –±—Ä–∞—É–∑–µ—Ä—ñ.</p>
                <button id="prepareBtn" class="btn">–ü—ñ–¥–≥–æ—Ç—É–≤–∞—Ç–∏ —Ñ–∞–π–ª</button>
            </div>

            <!-- –°–µ–∫—Ü—ñ—è 2: –ü–æ—Å–∏–ª–∞–Ω–Ω—è –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥—É –≤ –±—Ä–∞—É–∑–µ—Ä (–∑'—è–≤–ª—è—î—Ç—å—Å—è –ø—ñ—Å–ª—è –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è –∫–Ω–æ–ø–∫–∏) -->
            <div id="linkReadySection">
                <p class="info" style="font-weight: bold;">‚úÖ –§–∞–π–ª –≥–æ—Ç–æ–≤–∏–π!</p>
                <p class="info">Telegram –±–ª–æ–∫—É—î –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É –Ω–∏–∂—á–µ, —â–æ–± –≤—ñ–¥–∫—Ä–∏—Ç–∏ –±—Ä–∞—É–∑–µ—Ä —ñ –ø–æ—á–∞—Ç–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è.</p>
                <a href="#" id="downloadLinkBtn" class="btn" target="_blank">–í—ñ–¥–∫—Ä–∏—Ç–∏ –≤ –±—Ä–∞—É–∑–µ—Ä—ñ —Ç–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏</a>
            </div>
            
            <!-- –°–µ–∫—Ü—ñ—è 3: –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —É—Å–ø—ñ—à–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è (–≤–∏–¥–∏–º–∞ —Ç—ñ–ª—å–∫–∏ –≤ –±—Ä–∞—É–∑–µ—Ä—ñ) -->
            <div id="postDownloadSection">
                <p class="info" style="font-weight: bold; color: #28a745;">üöÄ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ä–æ–∑–ø–æ—á–∞—Ç–æ!</p>
                <p class="info">–§–∞–π–ª –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —É –≤–∞—à–æ–º—É –ø—Ä–∏—Å—Ç—Ä–æ—ó. –¢–µ–ø–µ—Ä –≤–∏ –º–æ–∂–µ—Ç–µ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—å –Ω–∞–∑–∞–¥.</p>
                <a href="tg://resolve" id="returnBtn" class="btn">–ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –≤ Telegram</a>
            </div>

        </div>
    </div>

    <script>
        // --- JAVASCRIPT –õ–û–ì–Ü–ö–ê ---

        // –ó–Ω–∞—Ö–æ–¥–∏–º–æ –≤—Å—ñ –Ω–∞—à—ñ —Å–µ–∫—Ü—ñ—ó —Ç–∞ –∫–Ω–æ–ø–∫–∏
        const initialSection = document.getElementById('initialSection');
        const linkReadySection = document.getElementById('linkReadySection');
        const postDownloadSection = document.getElementById('postDownloadSection');
        
        const prepareBtn = document.getElementById('prepareBtn');
        const downloadLinkBtn = document.getElementById('downloadLinkBtn');

        /**
         * –ì–µ–Ω–µ—Ä—É—î –≤–∏–ø–∞–¥–∫–æ–≤–∏–π —Ç–µ–∫—Å—Ç –∑–∞–¥–∞–Ω–æ—ó –¥–æ–≤–∂–∏–Ω–∏.
         */
        function generateRandomText(length) {
            let result = '';
            const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            for (let i = 0; i < length; i++) {
                result += characters.charAt(Math.floor(Math.random() * characters.length));
            }
            return result;
        }

        /**
         * –Ü–Ω—ñ—Ü—ñ—é—î –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—É.
         */
        function triggerDownload(blob, filename) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            URL.revokeObjectURL(url);
            document.body.removeChild(a);
        }

        /**
         * –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —Å—Ç–≤–æ—Ä—é—î zip-–∞—Ä—Ö—ñ–≤ —ñ –∑–∞–ø—É—Å–∫–∞—î –π–æ–≥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è.
         */
        async function generateAndDownload() {
            try {
                // –ü–æ–∫–∞–∑—É—î–º–æ —Ñ—ñ–Ω–∞–ª—å–Ω–∏–π –µ–∫—Ä–∞–Ω —ñ —Ö–æ–≤–∞—î–º–æ —ñ–Ω—à—ñ
                initialSection.style.display = 'none';
                linkReadySection.style.display = 'none';
                postDownloadSection.style.display = 'block';

                // –°—Ç–≤–æ—Ä—é—î–º–æ –∞—Ä—Ö—ñ–≤
                const zip = new JSZip();
                const testFolder = zip.folder('test');
                const randomContent = generateRandomText(3000);
                testFolder.file('random_text.txt', randomContent);
                
                // –ì–µ–Ω–µ—Ä—É—î–º–æ blob —ñ –∑–∞–ø—É—Å–∫–∞—î–º–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
                const content = await zip.generateAsync({ type: 'blob' });
                triggerDownload(content, 'my_addon.mcaddon');

            } catch (error) {
                console.error("–ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥ —á–∞—Å —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ñ–∞–π–ª—É:", error);
                alert("–ù–µ –≤–¥–∞–ª–æ—Å—è —Å—Ç–≤–æ—Ä–∏—Ç–∏ —Ñ–∞–π–ª. –ë—É–¥—å –ª–∞—Å–∫–∞, —Å–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.");
            }
        }

        // --- –ì–û–õ–û–í–ù–ê –õ–û–ì–Ü–ö–ê ---
        window.addEventListener('load', () => {
            const urlParams = new URLSearchParams(window.location.search);

            // –°—Ü–µ–Ω–∞—Ä—ñ–π 1: –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤—ñ–¥–∫—Ä–∏–≤ —Å—Ç–æ—Ä—ñ–Ω–∫—É –≤ –æ—Å–Ω–æ–≤–Ω–æ–º—É –±—Ä–∞—É–∑–µ—Ä—ñ –∑–∞ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏–º –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º
            if (urlParams.get('start_download') === 'true') {
                generateAndDownload();
            } 
            // –°—Ü–µ–Ω–∞—Ä—ñ–π 2: –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤—ñ–¥–∫—Ä–∏–≤ —Å—Ç–æ—Ä—ñ–Ω–∫—É –≤–ø–µ—Ä—à–µ (–≤—Å–µ—Ä–µ–¥–∏–Ω—ñ Telegram)
            else {
                prepareBtn.addEventListener('click', () => {
                    // –§–æ—Ä–º—É—î–º–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
                    // –í–∏–¥–∞–ª—è—î–º–æ –º–æ–∂–ª–∏–≤—ñ —Å—Ç–∞—Ä—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ —ñ –¥–æ–¥–∞—î–º–æ –Ω–æ–≤–∏–π
                    const downloadUrl = window.location.href.split('?')[0] + '?start_download=true';
                    
                    // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ —Ü–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –¥–ª—è –∫–Ω–æ–ø–∫–∏-–ø–æ—Å–∏–ª–∞–Ω–Ω—è
                    downloadLinkBtn.href = downloadUrl;

                    // –•–æ–≤–∞—î–º–æ –ø–æ—á–∞—Ç–∫–æ–≤—É —Å–µ–∫—Ü—ñ—é —ñ –ø–æ–∫–∞–∑—É—î–º–æ —Å–µ–∫—Ü—ñ—é –∑ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º
                    initialSection.style.display = 'none';
                    linkReadySection.style.display = 'block';
                });
            }
        });
    </script>
</body>
</html>
